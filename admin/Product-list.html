<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Sidebar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            overflow-x: hidden;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            background: #343a40;
            color: #fff;
            padding: 20px;
            position: fixed;
            left: 0;
            top: 0;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar .nav-link {
            color: #ddd;
            padding: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar .nav-link:hover {
            color: #fff;
        }

        /* Content next to sidebar on desktop */
        .content {
            margin-left: 250px;
            padding: 20px;
            transition: 0.3s;
        }

        .hamburger {
            position: fixed;
            top: 15px;
            left: 15px;
            display: none;
            z-index: 5000 !important;
        }

        .chart-container {
            width: 100%;
            /* make it full width */
            max-width: 900px;
            /* optional max width */
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .chart-container canvas {
            /* ensure canvas always fills container */
            width: 100% !important;
            height: auto !important;
        }



        /* MOBILE FIXES */
        @media (max-width: 768px) {

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .hamburger {
                display: block;
            }

            /* Content should NOT be shifted on mobile */
            .content {
                margin-left: 0;
            }
        }

        /* Hamburger button */


        .close-btn {
            font-size: 32px;
            /* size of the X */
            cursor: pointer;
            display: inline-block;
            z-index: 5000 !important;
        }


        /* Dashboard cards */
        .stat-card {
            padding: 20px;
            border-radius: 10px;
            background: #fff;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: .2s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }
    </style>
</head>

<body>

    <!-- Hamburger Menu -->
    <div class="hamburger" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo mb-3 d-flex align-items-center justify-content-between">
            <h4>Admin</h4>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Product-list.html"><i class="bi bi-box-seam"></i> Products</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="Users-list.html"><i class="fas fa-users"></i> Users</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-cog"></i> Settings</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="content">
        <div class="container mt-4">

            <!-- Dropdown -->
            <div class="mb-3 d-flex justify-content-between">
                <h2>Product List</h2>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        Options
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                                data-bs-target="#addProductModal">Add Product</a></li>
                        <li><a class="dropdown-item" href="#">Export List</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                    </ul>
                </div>
            </div>

            <!-- Product Table -->
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Product Name</th>
                            <th>Specs Description</th>
                            <th>Price</th>
                            <th>Rate</th> <!-- Added Price header -->
                            <th>Stock</th>
                            <th>Sold</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Example Row -->
                        <tr>
                            <td>Product A</td>
                            <td>High quality, durable</td>
                            <td>₱500</td>
                            <td>₱1500</td> <!-- Added Price cell -->
                            <td>120</td>
                            <td>50</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1">Edit</button>
                                <button class="btn btn-sm btn-danger">Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Product B</td>
                            <td>Compact and lightweight</td>
                            <td>₱300</td>
                            <td>₱900</td> <!-- Added Price cell -->
                            <td>80</td>
                            <td>30</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-1">Edit</button>
                                <button class="btn btn-sm btn-danger">Delete</button>
                            </td>
                        </tr>
                        <!-- Add more rows as needed -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel"
            aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <!-- Modal Body / Form -->
                    <div class="modal-body">
                        <form id="addProductForm" action="../php/product.php" method="POST"
                            enctype="multipart/form-data">

                            <!-- Product Name -->
                            <div class="mb-3">
                                <label for="productName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" name="productName"
                                    placeholder="Enter product name" required>
                            </div>

                            <div class="mb-3">
                                <label for="Price" class="form-label">Price</label>
                                <input type="number" class="form-control" id="price" name="price"
                                    placeholder="Enter price " required>
                            </div>

                            <!-- Specs Description -->
                            <div class="mb-3">
                                <label for="specsDescription" class="form-label">Specs Description</label>
                                <textarea class="form-control" id="specsDescription" name="specsDescription" rows="3"
                                    placeholder="Enter specs description" required></textarea>
                            </div>

                            <!-- Rate -->
                            <div class="mb-3">
                                <label class="form-label">Rate</label>
                                <div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rate" id="star1" value="1"
                                            required>
                                        <label class="form-check-label" for="star1">★ </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rate" id="star2" value="2">
                                        <label class="form-check-label" for="star2">★ ★ </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rate" id="star3" value="3">
                                        <label class="form-check-label" for="star3">★ ★ ★ </label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rate" id="star4" value="4">
                                        <label class="form-check-label" for="star4">★ ★ ★ ★</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="rate" id="star5" value="5">
                                        <label class="form-check-label" for="star5">★ ★ ★ ★ ★ </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Stock -->
                            <div class="mb-3">
                                <label for="stock" class="form-label">Stock</label>
                                <input type="number" class="form-control" id="stock" name="stock"
                                    placeholder="Enter stock quantity" min="0" required>
                            </div>

                            <!-- Product Image -->
                            <div class="mb-3">
                                <label for="productImage" class="form-label">Upload Image</label>
                                <input class="form-control" type="file" id="productImage" name="productImage"
                                    accept="image/*">
                            </div>

                            <!-- Modal Footer -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" form="addProductForm" class="btn btn-primary">Save
                                    Product</button>
                            </div>

                        </form>
                    </div>



                </div>
            </div>
        </div>

    </div>
    </div>
    </div>
    </div>
    <script>
        function loadProducts() {
            fetch("../php/product.php")
                .then(res => res.json())
                .then(data => {
                    if (!data.success) {
                        console.error("Error fetching products:", data.message);
                        return;
                    }

                    const tbody = document.querySelector("table tbody");
                    tbody.innerHTML = ""; // clear existing rows

                    data.products.forEach(product => {
                        const tr = document.createElement("tr");

                        tr.innerHTML = `
                    <td>${product['Product Name']}</td>
                    <td>${product['Description']}</td>
                    <td>${product['Price']}</td>
                    <td>${product['Ratings']}</td>
                    <td>${product['Stock']}</td>
                    <td>${product['Sold']}</td>
                    <td>
                        <button class="btn btn-sm btn-warning me-1 edit-btn" data-product='${JSON.stringify(product).replace(/'/g, "&apos;")}'>Edit</button>
                        <button class="btn btn-sm btn-danger delete-btn" data-name="${product['Product Name']}">Delete</button>
                    </td>
                `;

                        tbody.appendChild(tr);
                    });
                })
                .catch(err => console.error("Fetch error:", err));
        }

        // Delete product function
        function deleteProduct(productName) {
            if (confirm(`Are you sure you want to delete "${productName}"?`)) {
                const formData = new FormData();
                formData.append('action', 'delete');
                formData.append('productName', productName);

                fetch("../php/product.php", {
                    method: "POST",
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);
                            loadProducts(); // Reload the table
                        } else {
                            alert("Error: " + data.message);
                        }
                    })
                    .catch(err => {
                        console.error("Delete error:", err);
                        alert("Failed to delete product");
                    });
            }
        }

        // Edit product function
        function editProduct(product) {
            // Populate the modal form with existing product data
            document.getElementById('productName').value = product['Product Name'];
            document.getElementById('specsDescription').value = product['Description'];
            document.getElementById('stock').value = product['Stock'];
            document.getElementById('price').value = product['Price']; // Added price

            // Select the correct rating radio button
            const rateRadio = document.querySelector(`input[name="rate"][value="${product['Ratings']}"]`);
            if (rateRadio) {
                rateRadio.checked = true;
            }

            // Show current product image (optional preview)
            const imgPreview = document.getElementById('currentProductImg');
            if (imgPreview) {
                imgPreview.src = product['Product Img'] || '';
                imgPreview.style.display = product['Product Img'] ? 'block' : 'none';
            }

            // Store original product name for updating
            const form = document.getElementById('addProductForm');
            form.dataset.originalName = product['Product Name'];
            form.dataset.editMode = 'true';
            form.dataset.currentImg = product['Product Img'] || ''; // store current image path

            // Change modal title and button text
            document.getElementById('addProductModalLabel').textContent = 'Edit Product';
            document.querySelector('#addProductForm button[type="submit"]').textContent = 'Update Product';

            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
            modal.show();
        }


        // Load products on page load
        document.addEventListener("DOMContentLoaded", function () {
            loadProducts();

            // Event delegation for delete and edit buttons
            document.querySelector("table tbody").addEventListener('click', function (e) {
                // Handle delete button
                if (e.target.classList.contains('delete-btn')) {
                    const productName = e.target.dataset.name;
                    deleteProduct(productName);
                }

                // Handle edit button
                if (e.target.classList.contains('edit-btn')) {
                    const productData = JSON.parse(e.target.dataset.product.replace(/&apos;/g, "'"));
                    editProduct(productData);
                }
            });

            // Handle form submission (for both add and edit) - ONLY ONCE
            document.getElementById('addProductForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                const isEditMode = this.dataset.editMode === 'true';

                if (isEditMode) {
                    formData.append('action', 'update');
                    formData.append('originalName', this.dataset.originalName);
                } else {
                    formData.append('action', 'add');
                }

                fetch("../php/product.php", {
                    method: "POST",
                    body: formData
                })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);

                            // Close modal
                            const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
                            modal.hide();

                            // Reset form and mode
                            this.reset();
                            delete this.dataset.originalName;
                            delete this.dataset.editMode;
                            document.getElementById('addProductModalLabel').textContent = 'Add New Product';
                            document.querySelector('#addProductForm button[type="submit"]').textContent = 'Save Product';

                            // Reload products
                            loadProducts();
                        } else {
                            alert("Error: " + data.message);
                        }
                    })
                    .catch(err => {
                        console.error("Form submission error:", err);
                        alert("Failed to submit form");
                    });
            });

            // Reset form when modal is closed without saving
            document.getElementById('addProductModal').addEventListener('hidden.bs.modal', function () {
                const form = document.getElementById('addProductForm');
                form.reset();
                delete form.dataset.originalName;
                delete form.dataset.editMode;
                document.getElementById('addProductModalLabel').textContent = 'Add New Product';
                document.querySelector('#addProductForm button[type="submit"]').textContent = 'Save Product';
            });
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }
    </script>

</body>

</html>