{
    "sourceFile": "php/cart.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1767746971784,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767747110725,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,18 +13,40 @@\n $user_id = $_POST[\"user_id\"];\r\n $cart = $_POST[\"cart\"];\r\n $quantity = $_POST[\"quantity\"];\r\n \r\n-// INSERT into carts table\r\n-$sql = \"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\";\r\n-$stmt = $conn->prepare($sql);\r\n-$stmt->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n+// Check if product already exists\r\n+$check = $conn->prepare(\"SELECT id FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+$check->bind_param(\"is\", $user_id, $cart);\r\n+$check->execute();\r\n+$result = $check->get_result();\r\n \r\n-if ($stmt->execute()) {\r\n-    echo json_encode([\"success\"=>true, \"message\"=>\"Item added to cart\"]);\r\n+if ($result->num_rows > 0) {\r\n+    // Item exists → update quantity\r\n+    $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n+    $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n+\r\n+    if ($update->execute()) {\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n+    } else {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Failed to update\"]);\r\n+    }\r\n+\r\n+    $update->close();\r\n+\r\n } else {\r\n-    echo json_encode([\"success\"=>false, \"message\"=>\"Failed to add\"]);\r\n+    // Item does NOT exist → insert new row\r\n+    $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n+    $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n+\r\n+    if ($insert->execute()) {\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Added to cart\"]);\r\n+    } else {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Failed to add\"]);\r\n+    }\r\n+\r\n+    $insert->close();\r\n }\r\n \r\n-$stmt->close();\r\n+$check->close();\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767747552255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,11 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set('display_errors', 1);\r\n+header(\"Content-Type: application/json\");\r\n+error_reporting(E_ALL);\r\n+ini_set('display_errors', 1);\r\n \r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n \r\n if ($conn->connect_error) {\r\n"
                },
                {
                    "date": 1767747560490,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,10 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set('display_errors', 1);\r\n-header(\"Content-Type: application/json\");\r\n-error_reporting(E_ALL);\r\n-ini_set('display_errors', 1);\r\n \r\n+\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n \r\n if ($conn->connect_error) {\r\n     echo json_encode([\"success\"=>false, \"message\"=>\"Database connection failed\"]);\r\n"
                },
                {
                    "date": 1767747747836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,53 +1,53 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n-ini_set('display_errors', 1);\r\n+ini_set(\"display_errors\", 1);\r\n \r\n-\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n-\r\n if ($conn->connect_error) {\r\n-    echo json_encode([\"success\"=>false, \"message\"=>\"Database connection failed\"]);\r\n-    exit();\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Database connection failed\"]);\r\n+    exit;\r\n }\r\n \r\n-$user_id = $_POST[\"user_id\"];\r\n-$cart = $_POST[\"cart\"];\r\n-$quantity = $_POST[\"quantity\"];\r\n+$user_id  = $_POST[\"user_id\"] ?? \"\";\r\n+$cart     = $_POST[\"cart\"] ?? \"\";\r\n+$quantity = $_POST[\"quantity\"] ?? \"\";\r\n \r\n-// Check if product already exists\r\n-$check = $conn->prepare(\"SELECT id FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+if (!$user_id || !$cart || !$quantity) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Missing fields\"]);\r\n+    exit;\r\n+}\r\n+\r\n+/*-------------------------------------------------\r\n+    CHECK IF ITEM ALREADY EXISTS FOR THIS USER\r\n+-------------------------------------------------*/\r\n+$check = $conn->prepare(\"SELECT user_id FROM carts WHERE user_id = ? AND Cart = ?\");\r\n $check->bind_param(\"is\", $user_id, $cart);\r\n $check->execute();\r\n-$result = $check->get_result();\r\n+$check->store_result();\r\n \r\n-if ($result->num_rows > 0) {\r\n-    // Item exists → update quantity\r\n+if ($check->num_rows > 0) {\r\n+    // UPDATE QUANTITY\r\n     $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n     $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n-\r\n+    \r\n     if ($update->execute()) {\r\n-        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Cart updated\"]);\r\n     } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Failed to update\"]);\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Update failed\"]);\r\n     }\r\n \r\n-    $update->close();\r\n-\r\n } else {\r\n-    // Item does NOT exist → insert new row\r\n+    // INSERT NEW ROW\r\n     $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n     $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n \r\n     if ($insert->execute()) {\r\n         echo json_encode([\"success\" => true, \"message\" => \"Added to cart\"]);\r\n     } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Failed to add\"]);\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Insert failed\"]);\r\n     }\r\n-\r\n-    $insert->close();\r\n }\r\n \r\n-$check->close();\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767770095794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,14 +2,16 @@\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n+// Database connection\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n     echo json_encode([\"success\" => false, \"message\" => \"Database connection failed\"]);\r\n     exit;\r\n }\r\n \r\n+// Retrieve POST data safely\r\n $user_id  = $_POST[\"user_id\"] ?? \"\";\r\n $cart     = $_POST[\"cart\"] ?? \"\";\r\n $quantity = $_POST[\"quantity\"] ?? \"\";\r\n \r\n@@ -18,35 +20,35 @@\n     exit;\r\n }\r\n \r\n /*-------------------------------------------------\r\n-    CHECK IF ITEM ALREADY EXISTS FOR THIS USER\r\n+    CHECK IF THIS CART ITEM ALREADY EXISTS\r\n -------------------------------------------------*/\r\n-$check = $conn->prepare(\"SELECT user_id FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+$check = $conn->prepare(\"SELECT Quantity FROM carts WHERE user_id = ? AND Cart = ?\");\r\n $check->bind_param(\"is\", $user_id, $cart);\r\n $check->execute();\r\n $check->store_result();\r\n \r\n if ($check->num_rows > 0) {\r\n-    // UPDATE QUANTITY\r\n+    // ITEM EXISTS: UPDATE QUANTITY\r\n     $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n     $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n-    \r\n+\r\n     if ($update->execute()) {\r\n         echo json_encode([\"success\" => true, \"message\" => \"Cart updated\"]);\r\n     } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Update failed\"]);\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Failed to update cart\"]);\r\n     }\r\n \r\n } else {\r\n-    // INSERT NEW ROW\r\n+    // ITEM DOES NOT EXIST: INSERT NEW\r\n     $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n     $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n \r\n     if ($insert->execute()) {\r\n         echo json_encode([\"success\" => true, \"message\" => \"Added to cart\"]);\r\n     } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Insert failed\"]);\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Failed to add to cart\"]);\r\n     }\r\n }\r\n \r\n $conn->close();\r\n"
                },
                {
                    "date": 1767770323361,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,16 +2,15 @@\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n-// Database connection\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n     echo json_encode([\"success\" => false, \"message\" => \"Database connection failed\"]);\r\n     exit;\r\n }\r\n \r\n-// Retrieve POST data safely\r\n+// POST data\r\n $user_id  = $_POST[\"user_id\"] ?? \"\";\r\n $cart     = $_POST[\"cart\"] ?? \"\";\r\n $quantity = $_POST[\"quantity\"] ?? \"\";\r\n \r\n@@ -20,28 +19,28 @@\n     exit;\r\n }\r\n \r\n /*-------------------------------------------------\r\n-    CHECK IF THIS CART ITEM ALREADY EXISTS\r\n+    Check if this cart item already exists\r\n+    Only same cart name for same user triggers update\r\n -------------------------------------------------*/\r\n $check = $conn->prepare(\"SELECT Quantity FROM carts WHERE user_id = ? AND Cart = ?\");\r\n $check->bind_param(\"is\", $user_id, $cart);\r\n $check->execute();\r\n $check->store_result();\r\n \r\n if ($check->num_rows > 0) {\r\n-    // ITEM EXISTS: UPDATE QUANTITY\r\n+    // Same cart exists → update quantity\r\n     $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n     $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n-\r\n+    \r\n     if ($update->execute()) {\r\n         echo json_encode([\"success\" => true, \"message\" => \"Cart updated\"]);\r\n     } else {\r\n         echo json_encode([\"success\" => false, \"message\" => \"Failed to update cart\"]);\r\n     }\r\n-\r\n } else {\r\n-    // ITEM DOES NOT EXIST: INSERT NEW\r\n+    // Different cart (or first time) → insert new row\r\n     $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n     $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n \r\n     if ($insert->execute()) {\r\n"
                },
                {
                    "date": 1767770973335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n+// Database connection\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n     echo json_encode([\"success\" => false, \"message\" => \"Database connection failed\"]);\r\n     exit;\r\n@@ -38,9 +39,9 @@\n     } else {\r\n         echo json_encode([\"success\" => false, \"message\" => \"Failed to update cart\"]);\r\n     }\r\n } else {\r\n-    // Different cart (or first time) → insert new row\r\n+    // New cart item → insert row\r\n     $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n     $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n \r\n     if ($insert->execute()) {\r\n"
                }
            ],
            "date": 1767746971784,
            "name": "Commit-0",
            "content": "<?php\r\nheader(\"Content-Type: application/json\");\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n\r\nif ($conn->connect_error) {\r\n    echo json_encode([\"success\"=>false, \"message\"=>\"Database connection failed\"]);\r\n    exit();\r\n}\r\n\r\n$user_id = $_POST[\"user_id\"];\r\n$cart = $_POST[\"cart\"];\r\n$quantity = $_POST[\"quantity\"];\r\n\r\n// INSERT into carts table\r\n$sql = \"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\";\r\n$stmt = $conn->prepare($sql);\r\n$stmt->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n\r\nif ($stmt->execute()) {\r\n    echo json_encode([\"success\"=>true, \"message\"=>\"Item added to cart\"]);\r\n} else {\r\n    echo json_encode([\"success\"=>false, \"message\"=>\"Failed to add\"]);\r\n}\r\n\r\n$stmt->close();\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}