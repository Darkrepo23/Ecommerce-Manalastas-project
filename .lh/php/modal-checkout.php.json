{
    "sourceFile": "php/modal-checkout.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1767848201031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767852309519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,18 +11,36 @@\n \r\n $user_id = $_POST[\"user_id\"] ?? '';\r\n $items = isset($_POST[\"items\"]) ? json_decode($_POST[\"items\"], true) : [];\r\n \r\n+// Expecting quantities as associative array: { \"Product Name\": quantity }\r\n+$quantities = isset($_POST[\"quantities\"]) ? json_decode($_POST[\"quantities\"], true) : [];\r\n+\r\n if ($user_id && !empty($items)) {\r\n-    $del = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+\r\n+    // Prepare delete statement for cart\r\n+    $delCart = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+\r\n+    // Prepare update statement for products\r\n+    $updateProd = $conn->prepare(\"UPDATE products SET Sold = Sold + ? WHERE `Product Name` = ?\");\r\n+\r\n     foreach ($items as $item) {\r\n-        $del->bind_param(\"is\", $user_id, $item);\r\n-        $del->execute();\r\n+        $qty = isset($quantities[$item]) ? intval($quantities[$item]) : 1;\r\n+\r\n+        // Update Sold column\r\n+        $updateProd->bind_param(\"is\", $qty, $item);\r\n+        $updateProd->execute();\r\n+\r\n+        // Remove from cart\r\n+        $delCart->bind_param(\"is\", $user_id, $item);\r\n+        $delCart->execute();\r\n     }\r\n-    $del->close();\r\n+\r\n+    $delCart->close();\r\n+    $updateProd->close();\r\n }\r\n \r\n-// You can also save shipping/payment info here if needed\r\n+// Optional: handle shipping/payment info here\r\n \r\n echo json_encode([\"success\" => true]);\r\n $conn->close();\r\n ?>\r\n"
                }
            ],
            "date": 1767848201031,
            "name": "Commit-0",
            "content": "<?php\r\nheader(\"Content-Type: application/json\");\r\nerror_reporting(E_ALL);\r\nini_set(\"display_errors\", 1);\r\n\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\nif ($conn->connect_error) {\r\n    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n    exit;\r\n}\r\n\r\n$user_id = $_POST[\"user_id\"] ?? '';\r\n$items = isset($_POST[\"items\"]) ? json_decode($_POST[\"items\"], true) : [];\r\n\r\nif ($user_id && !empty($items)) {\r\n    $del = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n    foreach ($items as $item) {\r\n        $del->bind_param(\"is\", $user_id, $item);\r\n        $del->execute();\r\n    }\r\n    $del->close();\r\n}\r\n\r\n// You can also save shipping/payment info here if needed\r\n\r\necho json_encode([\"success\" => true]);\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}