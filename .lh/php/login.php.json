{
    "sourceFile": "php/login.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1767725646368,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767725709068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,102 +1,38 @@\n <?php\r\n header('Content-Type: application/json');\r\n error_reporting(E_ALL);\r\n-ini_set('display_errors', 1);\r\n \r\n // Connect to DB\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n-if ($conn->connect_error) {\r\n-    echo json_encode(['success' => false, 'message' => 'DB connection failed']);\r\n+if($conn->connect_error){\r\n+    echo json_encode(['success'=>false,'message'=>'DB connection failed']);\r\n     exit();\r\n }\r\n \r\n // Get JSON body\r\n $data = json_decode(file_get_contents(\"php://input\"), true);\r\n-$action = $data['action'] ?? ''; // \"register\" or \"login\"\r\n+$username = $conn->real_escape_string($data['username'] ?? '');\r\n+$email = $conn->real_escape_string($data['email'] ?? '');\r\n+$password = $data['password'] ?? '';\r\n \r\n-if ($action === 'register') {\r\n-    // Registration\r\n-    $username = $conn->real_escape_string($data['username'] ?? '');\r\n-    $email = $conn->real_escape_string($data['email'] ?? '');\r\n-    $password = $data['password'] ?? '';\r\n-\r\n-    if (!$username || !$email || !$password) {\r\n-        echo json_encode(['success' => false, 'message' => 'All fields are required']);\r\n-        exit();\r\n-    }\r\n-\r\n-    // Check if email already exists\r\n-    $stmt = $conn->prepare(\"SELECT ID FROM users WHERE Email = ? LIMIT 1\");\r\n-    $stmt->bind_param(\"s\", $email);\r\n-    $stmt->execute();\r\n-    $stmt->store_result();\r\n-    if ($stmt->num_rows > 0) {\r\n-        echo json_encode(['success' => false, 'message' => 'Email already exists']);\r\n-        $stmt->close();\r\n-        $conn->close();\r\n-        exit();\r\n-    }\r\n-    $stmt->close();\r\n-\r\n-    // Hash password\r\n-    $hashed = password_hash($password, PASSWORD_DEFAULT);\r\n-\r\n-    // Insert into database\r\n-    $stmt = $conn->prepare(\"INSERT INTO users (Username, Email, Password, DateCreated) VALUES (?, ?, ?, NOW())\");\r\n-    $stmt->bind_param(\"sss\", $username, $email, $hashed);\r\n-\r\n-    if ($stmt->execute()) {\r\n-        echo json_encode(['success' => true, 'message' => 'User created successfully']);\r\n-    } else {\r\n-        echo json_encode(['success' => false, 'message' => 'DB insert error: ' . $stmt->error]);\r\n-    }\r\n-\r\n-    $stmt->close();\r\n-    $conn->close();\r\n+if(!$username || !$email || !$password){\r\n+    echo json_encode(['success'=>false,'message'=>'All fields are required']);\r\n     exit();\r\n }\r\n \r\n-elseif ($action === 'login') {\r\n-    // Login\r\n-    $email = $conn->real_escape_string($data['email'] ?? '');\r\n-    $password = $data['password'] ?? '';\r\n+// Hash password\r\n+$hashed = password_hash($password, PASSWORD_DEFAULT);\r\n \r\n-    if (!$email || !$password) {\r\n-        echo json_encode(['success' => false, 'message' => 'Email and password are required']);\r\n-        exit();\r\n-    }\r\n+// Insert into database\r\n+$stmt = $conn->prepare(\"INSERT INTO users (Username, Email, Password, DateCreated) VALUES (?, ?, ?, NOW())\");\r\n+$stmt->bind_param(\"sss\", $username, $email, $hashed);\r\n \r\n-    $stmt = $conn->prepare(\"SELECT ID, Username, Password FROM users WHERE Email = ? LIMIT 1\");\r\n-    $stmt->bind_param(\"s\", $email);\r\n-    $stmt->execute();\r\n-    $result = $stmt->get_result();\r\n-\r\n-    if ($result && $result->num_rows > 0) {\r\n-        $user = $result->fetch_assoc();\r\n-        // Verify password\r\n-        if (password_verify($password, $user['Password'])) {\r\n-            echo json_encode([\r\n-                'success' => true,\r\n-                'data' => [\r\n-                    'ID' => $user['ID'],\r\n-                    'Username' => $user['Username']\r\n-                ]\r\n-            ]);\r\n-        } else {\r\n-            echo json_encode(['success' => false, 'message' => 'Invalid password']);\r\n-        }\r\n-    } else {\r\n-        echo json_encode(['success' => false, 'message' => 'User not found']);\r\n-    }\r\n-\r\n-    $stmt->close();\r\n-    $conn->close();\r\n-    exit();\r\n+if($stmt->execute()){\r\n+    echo json_encode(['success'=>true,'message'=>'User created successfully']);\r\n+} else {\r\n+    echo json_encode(['success'=>false,'message'=>'DB insert error: '.$stmt->error]);\r\n }\r\n \r\n-else {\r\n-    echo json_encode(['success' => false, 'message' => 'Invalid action']);\r\n-    $conn->close();\r\n-    exit();\r\n-}\r\n+$stmt->close();\r\n+$conn->close();\r\n ?>\r\n"
                }
            ],
            "date": 1767725646368,
            "name": "Commit-0",
            "content": "<?php\r\nheader('Content-Type: application/json');\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', 1);\r\n\r\n// Connect to DB\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\nif ($conn->connect_error) {\r\n    echo json_encode(['success' => false, 'message' => 'DB connection failed']);\r\n    exit();\r\n}\r\n\r\n// Get JSON body\r\n$data = json_decode(file_get_contents(\"php://input\"), true);\r\n$action = $data['action'] ?? ''; // \"register\" or \"login\"\r\n\r\nif ($action === 'register') {\r\n    // Registration\r\n    $username = $conn->real_escape_string($data['username'] ?? '');\r\n    $email = $conn->real_escape_string($data['email'] ?? '');\r\n    $password = $data['password'] ?? '';\r\n\r\n    if (!$username || !$email || !$password) {\r\n        echo json_encode(['success' => false, 'message' => 'All fields are required']);\r\n        exit();\r\n    }\r\n\r\n    // Check if email already exists\r\n    $stmt = $conn->prepare(\"SELECT ID FROM users WHERE Email = ? LIMIT 1\");\r\n    $stmt->bind_param(\"s\", $email);\r\n    $stmt->execute();\r\n    $stmt->store_result();\r\n    if ($stmt->num_rows > 0) {\r\n        echo json_encode(['success' => false, 'message' => 'Email already exists']);\r\n        $stmt->close();\r\n        $conn->close();\r\n        exit();\r\n    }\r\n    $stmt->close();\r\n\r\n    // Hash password\r\n    $hashed = password_hash($password, PASSWORD_DEFAULT);\r\n\r\n    // Insert into database\r\n    $stmt = $conn->prepare(\"INSERT INTO users (Username, Email, Password, DateCreated) VALUES (?, ?, ?, NOW())\");\r\n    $stmt->bind_param(\"sss\", $username, $email, $hashed);\r\n\r\n    if ($stmt->execute()) {\r\n        echo json_encode(['success' => true, 'message' => 'User created successfully']);\r\n    } else {\r\n        echo json_encode(['success' => false, 'message' => 'DB insert error: ' . $stmt->error]);\r\n    }\r\n\r\n    $stmt->close();\r\n    $conn->close();\r\n    exit();\r\n}\r\n\r\nelseif ($action === 'login') {\r\n    // Login\r\n    $email = $conn->real_escape_string($data['email'] ?? '');\r\n    $password = $data['password'] ?? '';\r\n\r\n    if (!$email || !$password) {\r\n        echo json_encode(['success' => false, 'message' => 'Email and password are required']);\r\n        exit();\r\n    }\r\n\r\n    $stmt = $conn->prepare(\"SELECT ID, Username, Password FROM users WHERE Email = ? LIMIT 1\");\r\n    $stmt->bind_param(\"s\", $email);\r\n    $stmt->execute();\r\n    $result = $stmt->get_result();\r\n\r\n    if ($result && $result->num_rows > 0) {\r\n        $user = $result->fetch_assoc();\r\n        // Verify password\r\n        if (password_verify($password, $user['Password'])) {\r\n            echo json_encode([\r\n                'success' => true,\r\n                'data' => [\r\n                    'ID' => $user['ID'],\r\n                    'Username' => $user['Username']\r\n                ]\r\n            ]);\r\n        } else {\r\n            echo json_encode(['success' => false, 'message' => 'Invalid password']);\r\n        }\r\n    } else {\r\n        echo json_encode(['success' => false, 'message' => 'User not found']);\r\n    }\r\n\r\n    $stmt->close();\r\n    $conn->close();\r\n    exit();\r\n}\r\n\r\nelse {\r\n    echo json_encode(['success' => false, 'message' => 'Invalid action']);\r\n    $conn->close();\r\n    exit();\r\n}\r\n?>\r\n"
        }
    ]
}