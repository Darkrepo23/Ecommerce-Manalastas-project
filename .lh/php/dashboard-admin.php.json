{
    "sourceFile": "php/dashboard-admin.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1767862544662,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767863048708,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,5 +35,54 @@\n     \"sales\" => $totalSales\r\n ]);\r\n \r\n $conn->close();\r\n+\r\n+\r\n+$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n+if ($conn->connect_error) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n+    exit;\r\n+}\r\n+\r\n+// ----------------- USERS -----------------\r\n+$userRes = $conn->query(\"SELECT COUNT(*) AS totalUsers FROM users\");\r\n+$totalUsers = ($userRes->num_rows > 0) ? $userRes->fetch_assoc()['totalUsers'] : 0;\r\n+\r\n+// ----------------- PRODUCTS -----------------\r\n+$prodRes = $conn->query(\"SELECT Sold, Price, AddingDate FROM products\");\r\n+$totalProducts = 0;\r\n+$totalSolds = 0;\r\n+$totalSales = 0;\r\n+\r\n+// For monthly chart\r\n+$salesByMonth = array_fill(1, 12, 0);\r\n+$soldsByMonth = array_fill(1, 12, 0);\r\n+\r\n+while ($row = $prodRes->fetch_assoc()) {\r\n+    $totalProducts++;\r\n+    $sold = (int)$row['Sold'];\r\n+    $price = (float)$row['Price'];\r\n+    $totalSolds += $sold;\r\n+    $totalSales += ($sold * $price);\r\n+\r\n+    $month = (int)date('n', strtotime($row['AddingDate'])); // 1-12\r\n+    $salesByMonth[$month] += ($sold * $price);\r\n+    $soldsByMonth[$month] += $sold;\r\n+}\r\n+\r\n+// Convert monthly arrays to 0-based index arrays\r\n+$salesByMonth = array_values($salesByMonth);\r\n+$soldsByMonth = array_values($soldsByMonth);\r\n+\r\n+echo json_encode([\r\n+    \"success\" => true,\r\n+    \"totalUsers\" => $totalUsers,\r\n+    \"totalProducts\" => $totalProducts,\r\n+    \"totalSolds\" => $totalSolds,\r\n+    \"totalSales\" => $totalSales,\r\n+    \"salesByMonth\" => $salesByMonth,\r\n+    \"soldsByMonth\" => $soldsByMonth\r\n+]);\r\n+\r\n+$conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767863111314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,52 +37,6 @@\n \r\n $conn->close();\r\n \r\n \r\n-$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n-if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n-    exit;\r\n-}\r\n \r\n-// ----------------- USERS -----------------\r\n-$userRes = $conn->query(\"SELECT COUNT(*) AS totalUsers FROM users\");\r\n-$totalUsers = ($userRes->num_rows > 0) ? $userRes->fetch_assoc()['totalUsers'] : 0;\r\n-\r\n-// ----------------- PRODUCTS -----------------\r\n-$prodRes = $conn->query(\"SELECT Sold, Price, AddingDate FROM products\");\r\n-$totalProducts = 0;\r\n-$totalSolds = 0;\r\n-$totalSales = 0;\r\n-\r\n-// For monthly chart\r\n-$salesByMonth = array_fill(1, 12, 0);\r\n-$soldsByMonth = array_fill(1, 12, 0);\r\n-\r\n-while ($row = $prodRes->fetch_assoc()) {\r\n-    $totalProducts++;\r\n-    $sold = (int)$row['Sold'];\r\n-    $price = (float)$row['Price'];\r\n-    $totalSolds += $sold;\r\n-    $totalSales += ($sold * $price);\r\n-\r\n-    $month = (int)date('n', strtotime($row['AddingDate'])); // 1-12\r\n-    $salesByMonth[$month] += ($sold * $price);\r\n-    $soldsByMonth[$month] += $sold;\r\n-}\r\n-\r\n-// Convert monthly arrays to 0-based index arrays\r\n-$salesByMonth = array_values($salesByMonth);\r\n-$soldsByMonth = array_values($soldsByMonth);\r\n-\r\n-echo json_encode([\r\n-    \"success\" => true,\r\n-    \"totalUsers\" => $totalUsers,\r\n-    \"totalProducts\" => $totalProducts,\r\n-    \"totalSolds\" => $totalSolds,\r\n-    \"totalSales\" => $totalSales,\r\n-    \"salesByMonth\" => $salesByMonth,\r\n-    \"soldsByMonth\" => $soldsByMonth\r\n-]);\r\n-\r\n-$conn->close();\r\n ?>\r\n"
                }
            ],
            "date": 1767862544662,
            "name": "Commit-0",
            "content": "<?php\r\nheader(\"Content-Type: application/json\");\r\nerror_reporting(E_ALL);\r\nini_set(\"display_errors\", 1);\r\n\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n\r\nif ($conn->connect_error) {\r\n    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n    exit;\r\n}\r\n\r\n// Total Users\r\n$users = $conn->query(\"SELECT COUNT(*) AS total_users FROM users\")->fetch_assoc()['total_users'];\r\n\r\n// Total Products\r\n$products = $conn->query(\"SELECT COUNT(*) AS total_products FROM products\")->fetch_assoc()['total_products'];\r\n\r\n// Total Solds (sum of Sold column)\r\n$solds = $conn->query(\"SELECT SUM(Sold) AS total_sold FROM products\")->fetch_assoc()['total_sold'];\r\n\r\n// Total Sales (sum of price * sold)\r\n$salesQuery = $conn->query(\"SELECT Price, Sold FROM products\");\r\n$totalSales = 0;\r\n\r\nwhile ($row = $salesQuery->fetch_assoc()) {\r\n    $totalSales += $row['Price'] * $row['Sold'];\r\n}\r\n\r\necho json_encode([\r\n    \"success\" => true,\r\n    \"users\" => $users,\r\n    \"products\" => $products,\r\n    \"solds\" => $solds,\r\n    \"sales\" => $totalSales\r\n]);\r\n\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}