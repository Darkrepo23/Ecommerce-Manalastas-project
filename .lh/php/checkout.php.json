{
    "sourceFile": "php/checkout.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 19,
            "patches": [
                {
                    "date": 1767767770942,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767767813097,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,54 +4,48 @@\n ini_set(\"display_errors\", 1);\r\n \r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Database failed\"]);\r\n     exit;\r\n }\r\n \r\n-$user_id = $_GET[\"user_id\"] ?? \"\";\r\n+$user_id  = $_POST[\"user_id\"] ?? null;\r\n+$cart     = $_POST[\"cart\"] ?? null;      // product name\r\n+$quantity = $_POST[\"quantity\"] ?? null;\r\n \r\n-if (!$user_id) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"Missing user_id\"]);\r\n+if (!$user_id || !$cart || !$quantity) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Missing data\"]);\r\n     exit;\r\n }\r\n \r\n-// GET USER CART\r\n-$cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n-$cartQuery->bind_param(\"i\", $user_id);\r\n-$cartQuery->execute();\r\n-$cartResult = $cartQuery->get_result();\r\n+// 1️⃣ CHECK IF ITEM ALREADY EXISTS FOR USER\r\n+$check = $conn->prepare(\"SELECT Quantity FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+$check->bind_param(\"is\", $user_id, $cart);\r\n+$check->execute();\r\n+$result = $check->get_result();\r\n \r\n-$cartItems = [];\r\n+if ($result->num_rows > 0) {\r\n+    // 2️⃣ ITEM EXISTS → UPDATE QUANTITY\r\n+    $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n+    $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n \r\n-while ($row = $cartResult->fetch_assoc()) {\r\n+    if ($update->execute()) {\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n+    } else {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Update failed\"]);\r\n+    }\r\n \r\n-    // Get product info from products table\r\n-    $productName = $row[\"Cart\"];\r\n+} else {\r\n+    // 3️⃣ ITEM DOES NOT EXIST → INSERT NEW CART ROW\r\n+    $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n+    $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n \r\n-    $productQuery = $conn->prepare(\r\n-        \"SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n-         FROM products WHERE `Product Name` = ? LIMIT 1\"\r\n-    );\r\n-    $productQuery->bind_param(\"s\", $productName);\r\n-    $productQuery->execute();\r\n-    $productData = $productQuery->get_result()->fetch_assoc();\r\n-\r\n-    if ($productData) {\r\n-        $cartItems[] = [\r\n-            \"name\"        => $productName,\r\n-            \"quantity\"    => $row[\"Quantity\"],\r\n-            \"description\" => $productData[\"Description\"],\r\n-            \"img\"         => $productData[\"Product Img\"],\r\n-            \"price\"       => $productData[\"Price\"]\r\n-        ];\r\n+    if ($insert->execute()) {\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Added to cart\"]);\r\n+    } else {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Insert failed\"]);\r\n     }\r\n }\r\n \r\n-echo json_encode([\r\n-    \"success\" => true,\r\n-    \"items\" => $cartItems\r\n-]);\r\n-\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767767879709,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,48 +4,54 @@\n ini_set(\"display_errors\", 1);\r\n \r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"Database failed\"]);\r\n+    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n     exit;\r\n }\r\n \r\n-$user_id  = $_POST[\"user_id\"] ?? null;\r\n-$cart     = $_POST[\"cart\"] ?? null;      // product name\r\n-$quantity = $_POST[\"quantity\"] ?? null;\r\n+$user_id = $_GET[\"user_id\"] ?? \"\";\r\n \r\n-if (!$user_id || !$cart || !$quantity) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"Missing data\"]);\r\n+if (!$user_id) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Missing user_id\"]);\r\n     exit;\r\n }\r\n \r\n-// 1️⃣ CHECK IF ITEM ALREADY EXISTS FOR USER\r\n-$check = $conn->prepare(\"SELECT Quantity FROM carts WHERE user_id = ? AND Cart = ?\");\r\n-$check->bind_param(\"is\", $user_id, $cart);\r\n-$check->execute();\r\n-$result = $check->get_result();\r\n+// GET USER CART\r\n+$cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n+$cartQuery->bind_param(\"i\", $user_id);\r\n+$cartQuery->execute();\r\n+$cartResult = $cartQuery->get_result();\r\n \r\n-if ($result->num_rows > 0) {\r\n-    // 2️⃣ ITEM EXISTS → UPDATE QUANTITY\r\n-    $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n-    $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n+$cartItems = [];\r\n \r\n-    if ($update->execute()) {\r\n-        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n-    } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Update failed\"]);\r\n-    }\r\n+while ($row = $cartResult->fetch_assoc()) {\r\n \r\n-} else {\r\n-    // 3️⃣ ITEM DOES NOT EXIST → INSERT NEW CART ROW\r\n-    $insert = $conn->prepare(\"INSERT INTO carts (user_id, Cart, Quantity) VALUES (?, ?, ?)\");\r\n-    $insert->bind_param(\"isi\", $user_id, $cart, $quantity);\r\n+    // Get product info from products table\r\n+    $productName = $row[\"Cart\"];\r\n \r\n-    if ($insert->execute()) {\r\n-        echo json_encode([\"success\" => true, \"message\" => \"Added to cart\"]);\r\n-    } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Insert failed\"]);\r\n+    $productQuery = $conn->prepare(\r\n+        \"SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n+         FROM products WHERE `Product Name` = ? LIMIT 1\"\r\n+    );\r\n+    $productQuery->bind_param(\"s\", $productName);\r\n+    $productQuery->execute();\r\n+    $productData = $productQuery->get_result()->fetch_assoc();\r\n+\r\n+    if ($productData) {\r\n+        $cartItems[] = [\r\n+            \"name\"        => $productName,\r\n+            \"quantity\"    => $row[\"Quantity\"],\r\n+            \"description\" => $productData[\"Description\"],\r\n+            \"img\"         => $productData[\"Product Img\"],\r\n+            \"price\"       => $productData[\"Price\"]\r\n+        ];\r\n     }\r\n }\r\n \r\n+echo json_encode([\r\n+    \"success\" => true,\r\n+    \"items\" => $cartItems\r\n+]);\r\n+\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767767954399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,50 +8,56 @@\n     echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n     exit;\r\n }\r\n \r\n-$user_id = $_GET[\"user_id\"] ?? \"\";\r\n+$user_id = $_POST[\"user_id\"] ?? \"\";\r\n \r\n if (!$user_id) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"Missing user_id\"]);\r\n+    echo json_encode([\"success\" => false, \"message\" => \"Missing user ID\"]);\r\n     exit;\r\n }\r\n \r\n-// GET USER CART\r\n+/* ==================================================\r\n+   1. GET ALL USER CART ITEMS\r\n+================================================== */\r\n $cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n $cartQuery->bind_param(\"i\", $user_id);\r\n $cartQuery->execute();\r\n $cartResult = $cartQuery->get_result();\r\n \r\n $cartItems = [];\r\n \r\n-while ($row = $cartResult->fetch_assoc()) {\r\n+while ($cart = $cartResult->fetch_assoc()) {\r\n \r\n-    // Get product info from products table\r\n-    $productName = $row[\"Cart\"];\r\n+    $productName = $cart[\"Cart\"];\r\n \r\n-    $productQuery = $conn->prepare(\r\n-        \"SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n-         FROM products WHERE `Product Name` = ? LIMIT 1\"\r\n-    );\r\n+    // Fetch matching product details\r\n+    $productQuery = $conn->prepare(\"\r\n+        SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n+        FROM products\r\n+        WHERE `Product Name` = ?\r\n+        LIMIT 1\r\n+    \");\r\n     $productQuery->bind_param(\"s\", $productName);\r\n     $productQuery->execute();\r\n-    $productData = $productQuery->get_result()->fetch_assoc();\r\n+    $productResult = $productQuery->get_result();\r\n \r\n-    if ($productData) {\r\n+    if ($productResult->num_rows > 0) {\r\n+        $product = $productResult->fetch_assoc();\r\n+\r\n         $cartItems[] = [\r\n-            \"name\"        => $productName,\r\n-            \"quantity\"    => $row[\"Quantity\"],\r\n-            \"description\" => $productData[\"Description\"],\r\n-            \"img\"         => $productData[\"Product Img\"],\r\n-            \"price\"       => $productData[\"Price\"]\r\n+            \"prodname\"    => $product[\"Product Name\"],\r\n+            \"description\" => $product[\"Description\"],\r\n+            \"prodimg\"     => $product[\"Product Img\"],\r\n+            \"price\"       => $product[\"Price\"],\r\n+            \"quantity\"    => (int)$cart[\"Quantity\"]\r\n         ];\r\n     }\r\n }\r\n \r\n echo json_encode([\r\n     \"success\" => true,\r\n-    \"items\" => $cartItems\r\n+    \"cart\" => $cartItems\r\n ]);\r\n \r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767768002903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,62 +2,88 @@\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n+// DB connection\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n if ($conn->connect_error) {\r\n     echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n     exit;\r\n }\r\n \r\n+$action = $_POST[\"action\"] ?? \"\";\r\n $user_id = $_POST[\"user_id\"] ?? \"\";\r\n \r\n if (!$user_id) {\r\n     echo json_encode([\"success\" => false, \"message\" => \"Missing user ID\"]);\r\n     exit;\r\n }\r\n \r\n-/* ==================================================\r\n-   1. GET ALL USER CART ITEMS\r\n-================================================== */\r\n-$cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n-$cartQuery->bind_param(\"i\", $user_id);\r\n-$cartQuery->execute();\r\n-$cartResult = $cartQuery->get_result();\r\n+/* ============================================================\r\n+   ACTION 1: UPDATE QUANTITY\r\n+============================================================ */\r\n+if ($action === \"update\") {\r\n+    $cart = $_POST[\"cart\"] ?? \"\";\r\n+    $quantity = $_POST[\"quantity\"] ?? \"\";\r\n \r\n-$cartItems = [];\r\n+    if (!$cart || !$quantity) {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Missing cart or quantity\"]);\r\n+        exit;\r\n+    }\r\n \r\n-while ($cart = $cartResult->fetch_assoc()) {\r\n+    $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n+    $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n \r\n-    $productName = $cart[\"Cart\"];\r\n+    if ($update->execute()) {\r\n+        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n+    } else {\r\n+        echo json_encode([\"success\" => false, \"message\" => \"Failed to update\"]);\r\n+    }\r\n+    exit;\r\n+}\r\n \r\n-    // Fetch matching product details\r\n-    $productQuery = $conn->prepare(\"\r\n-        SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n-        FROM products\r\n-        WHERE `Product Name` = ?\r\n-        LIMIT 1\r\n-    \");\r\n-    $productQuery->bind_param(\"s\", $productName);\r\n-    $productQuery->execute();\r\n-    $productResult = $productQuery->get_result();\r\n+/* ============================================================\r\n+   ACTION 2: GET FULL CART LIST\r\n+============================================================ */\r\n+if ($action === \"get\") {\r\n \r\n-    if ($productResult->num_rows > 0) {\r\n-        $product = $productResult->fetch_assoc();\r\n+    $cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n+    $cartQuery->bind_param(\"i\", $user_id);\r\n+    $cartQuery->execute();\r\n+    $result = $cartQuery->get_result();\r\n \r\n-        $cartItems[] = [\r\n-            \"prodname\"    => $product[\"Product Name\"],\r\n-            \"description\" => $product[\"Description\"],\r\n-            \"prodimg\"     => $product[\"Product Img\"],\r\n-            \"price\"       => $product[\"Price\"],\r\n-            \"quantity\"    => (int)$cart[\"Quantity\"]\r\n-        ];\r\n+    $cartItems = [];\r\n+\r\n+    while ($row = $result->fetch_assoc()) {\r\n+        $cartName = $row[\"Cart\"];\r\n+\r\n+        // Match with products table\r\n+        $prodQuery = $conn->prepare(\"\r\n+            SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n+            FROM products\r\n+            WHERE `Product Name` = ?\r\n+            LIMIT 1\r\n+        \");\r\n+        $prodQuery->bind_param(\"s\", $cartName);\r\n+        $prodQuery->execute();\r\n+        $prodResult = $prodQuery->get_result();\r\n+\r\n+        if ($prodResult->num_rows > 0) {\r\n+            $prod = $prodResult->fetch_assoc();\r\n+\r\n+            $cartItems[] = [\r\n+                \"prodname\"    => $prod[\"Product Name\"],\r\n+                \"description\" => $prod[\"Description\"],\r\n+                \"prodimg\"     => $prod[\"Product Img\"],\r\n+                \"price\"       => $prod[\"Price\"],\r\n+                \"quantity\"    => (int) $row[\"Quantity\"]\r\n+            ];\r\n+        }\r\n     }\r\n+\r\n+    echo json_encode([\"success\" => true, \"cart\" => $cartItems]);\r\n+    exit;\r\n }\r\n \r\n-echo json_encode([\r\n-    \"success\" => true,\r\n-    \"cart\" => $cartItems\r\n-]);\r\n-\r\n+echo json_encode([\"success\" => false, \"message\" => \"Invalid action\"]);\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767768589581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,88 +2,86 @@\n header(\"Content-Type: application/json\");\r\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n-// DB connection\r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n+\r\n if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n+    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"DB Connection Failed\"]);\r\n     exit;\r\n }\r\n \r\n-$action = $_POST[\"action\"] ?? \"\";\r\n $user_id = $_POST[\"user_id\"] ?? \"\";\r\n \r\n if (!$user_id) {\r\n-    echo json_encode([\"success\" => false, \"message\" => \"Missing user ID\"]);\r\n+    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"Missing user ID\"]);\r\n     exit;\r\n }\r\n \r\n-/* ============================================================\r\n-   ACTION 1: UPDATE QUANTITY\r\n-============================================================ */\r\n-if ($action === \"update\") {\r\n-    $cart = $_POST[\"cart\"] ?? \"\";\r\n-    $quantity = $_POST[\"quantity\"] ?? \"\";\r\n+/* -------------------------------------------\r\n+   STEP 1: GET USER CART ITEMS\r\n+--------------------------------------------*/\r\n+$cartSQL = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n+$cartSQL->bind_param(\"i\", $user_id);\r\n+$cartSQL->execute();\r\n+$cartResult = $cartSQL->get_result();\r\n \r\n-    if (!$cart || !$quantity) {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Missing cart or quantity\"]);\r\n-        exit;\r\n-    }\r\n-\r\n-    $update = $conn->prepare(\"UPDATE carts SET Quantity = ? WHERE user_id = ? AND Cart = ?\");\r\n-    $update->bind_param(\"iis\", $quantity, $user_id, $cart);\r\n-\r\n-    if ($update->execute()) {\r\n-        echo json_encode([\"success\" => true, \"message\" => \"Quantity updated\"]);\r\n-    } else {\r\n-        echo json_encode([\"success\" => false, \"message\" => \"Failed to update\"]);\r\n-    }\r\n+if ($cartResult->num_rows == 0) {\r\n+    echo json_encode([\"success\" => true, \"html\" => \"<p>No items in your cart.</p>\"]);\r\n     exit;\r\n }\r\n \r\n-/* ============================================================\r\n-   ACTION 2: GET FULL CART LIST\r\n-============================================================ */\r\n-if ($action === \"get\") {\r\n+$html = \"\";\r\n \r\n-    $cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n-    $cartQuery->bind_param(\"i\", $user_id);\r\n-    $cartQuery->execute();\r\n-    $result = $cartQuery->get_result();\r\n+/* -------------------------------------------\r\n+   STEP 2: LOOP CART ITEMS & MATCH PRODUCTS\r\n+--------------------------------------------*/\r\n+while ($cartRow = $cartResult->fetch_assoc()) {\r\n+    $productName = $cartRow[\"Cart\"];\r\n+    $quantity = $cartRow[\"Quantity\"];\r\n \r\n-    $cartItems = [];\r\n+    $prodSQL = $conn->prepare(\"SELECT `Product Name`, `Description`, `Product Img`, `Price` FROM products WHERE `Product Name` = ? LIMIT 1\");\r\n+    $prodSQL->bind_param(\"s\", $productName);\r\n+    $prodSQL->execute();\r\n+    $prodResult = $prodSQL->get_result();\r\n \r\n-    while ($row = $result->fetch_assoc()) {\r\n-        $cartName = $row[\"Cart\"];\r\n+    if ($prodResult->num_rows > 0) {\r\n+        $prod = $prodResult->fetch_assoc();\r\n \r\n-        // Match with products table\r\n-        $prodQuery = $conn->prepare(\"\r\n-            SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n-            FROM products\r\n-            WHERE `Product Name` = ?\r\n-            LIMIT 1\r\n-        \");\r\n-        $prodQuery->bind_param(\"s\", $cartName);\r\n-        $prodQuery->execute();\r\n-        $prodResult = $prodQuery->get_result();\r\n+        $img = $prod[\"Product Img\"];\r\n+        $desc = $prod[\"Description\"];\r\n+        $price = number_format($prod[\"Price\"], 2);\r\n \r\n-        if ($prodResult->num_rows > 0) {\r\n-            $prod = $prodResult->fetch_assoc();\r\n+        /* -------------------------------------------\r\n+           BUILD CART ITEM HTML\r\n+        --------------------------------------------*/\r\n+        $html .= '\r\n+        <div class=\"cart-item mb-3\">\r\n+            <div class=\"row align-items-center\">\r\n+                <div class=\"col-md-2 col-3\">\r\n+                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+                </div>\r\n \r\n-            $cartItems[] = [\r\n-                \"prodname\"    => $prod[\"Product Name\"],\r\n-                \"description\" => $prod[\"Description\"],\r\n-                \"prodimg\"     => $prod[\"Product Img\"],\r\n-                \"price\"       => $prod[\"Price\"],\r\n-                \"quantity\"    => (int) $row[\"Quantity\"]\r\n-            ];\r\n-        }\r\n+                <div class=\"col-md-6 col-9\">\r\n+                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+                </div>\r\n+\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                    <div class=\"input-group input-group-sm\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                    </div>\r\n+                </div>\r\n+\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n+                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+                </div>\r\n+            </div>\r\n+        </div>';\r\n     }\r\n-\r\n-    echo json_encode([\"success\" => true, \"cart\" => $cartItems]);\r\n-    exit;\r\n }\r\n \r\n-echo json_encode([\"success\" => false, \"message\" => \"Invalid action\"]);\r\n+echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n-?>\r\n"
                },
                {
                    "date": 1767768771178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,24 +3,30 @@\n error_reporting(E_ALL);\r\n ini_set(\"display_errors\", 1);\r\n \r\n $conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n-\r\n if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"DB Connection Failed\"]);\r\n+    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"DB connection failed\"]);\r\n     exit;\r\n }\r\n \r\n-$user_id = $_POST[\"user_id\"] ?? \"\";\r\n+$user_id = $_POST[\"user_id\"] ?? '';\r\n+$cart    = $_POST[\"cart\"] ?? null;\r\n+$change  = isset($_POST[\"change\"]) ? intval($_POST[\"change\"]) : null;\r\n \r\n-if (!$user_id) {\r\n-    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"Missing user ID\"]);\r\n-    exit;\r\n+// ---------------------------\r\n+// STEP 1: If change exists, update quantity\r\n+// ---------------------------\r\n+if ($cart !== null && $change !== null) {\r\n+    $update = $conn->prepare(\"UPDATE carts SET Quantity = GREATEST(1, Quantity + ?) WHERE user_id = ? AND Cart = ?\");\r\n+    $update->bind_param(\"iis\", $change, $user_id, $cart);\r\n+    $update->execute();\r\n+    $update->close();\r\n }\r\n \r\n-/* -------------------------------------------\r\n-   STEP 1: GET USER CART ITEMS\r\n---------------------------------------------*/\r\n+// ---------------------------\r\n+// STEP 2: Fetch cart items & build HTML\r\n+// ---------------------------\r\n $cartSQL = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n $cartSQL->bind_param(\"i\", $user_id);\r\n $cartSQL->execute();\r\n $cartResult = $cartSQL->get_result();\r\n@@ -31,11 +37,8 @@\n }\r\n \r\n $html = \"\";\r\n \r\n-/* -------------------------------------------\r\n-   STEP 2: LOOP CART ITEMS & MATCH PRODUCTS\r\n---------------------------------------------*/\r\n while ($cartRow = $cartResult->fetch_assoc()) {\r\n     $productName = $cartRow[\"Cart\"];\r\n     $quantity = $cartRow[\"Quantity\"];\r\n \r\n@@ -45,16 +48,12 @@\n     $prodResult = $prodSQL->get_result();\r\n \r\n     if ($prodResult->num_rows > 0) {\r\n         $prod = $prodResult->fetch_assoc();\r\n-\r\n         $img = $prod[\"Product Img\"];\r\n         $desc = $prod[\"Description\"];\r\n         $price = number_format($prod[\"Price\"], 2);\r\n \r\n-        /* -------------------------------------------\r\n-           BUILD CART ITEM HTML\r\n-        --------------------------------------------*/\r\n         $html .= '\r\n         <div class=\"cart-item mb-3\">\r\n             <div class=\"row align-items-center\">\r\n                 <div class=\"col-md-2 col-3\">\r\n@@ -84,4 +83,5 @@\n }\r\n \r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n+?>\r\n"
                },
                {
                    "date": 1767768791511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,8 +12,20 @@\n $user_id = $_POST[\"user_id\"] ?? '';\r\n $cart    = $_POST[\"cart\"] ?? null;\r\n $change  = isset($_POST[\"change\"]) ? intval($_POST[\"change\"]) : null;\r\n \r\n+\r\n+\r\n+$remove = isset($_POST[\"remove\"]) ? intval($_POST[\"remove\"]) : null;\r\n+\r\n+if ($cart !== null && $remove === 1) {\r\n+    $del = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+    $del->bind_param(\"is\", $user_id, $cart);\r\n+    $del->execute();\r\n+    $del->close();\r\n+}\r\n+\r\n+\r\n // ---------------------------\r\n // STEP 1: If change exists, update quantity\r\n // ---------------------------\r\n if ($cart !== null && $change !== null) {\r\n"
                },
                {
                    "date": 1767769173202,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,9 +60,10 @@\n     $prodResult = $prodSQL->get_result();\r\n \r\n     if ($prodResult->num_rows > 0) {\r\n         $prod = $prodResult->fetch_assoc();\r\n-        $img = $prod[\"Product Img\"];\r\n+       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+\r\n         $desc = $prod[\"Description\"];\r\n         $price = number_format($prod[\"Price\"], 2);\r\n \r\n         $html .= '\r\n"
                },
                {
                    "date": 1767769293221,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,38 +61,47 @@\n \r\n     if ($prodResult->num_rows > 0) {\r\n         $prod = $prodResult->fetch_assoc();\r\n        $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n-\r\n         $desc = $prod[\"Description\"];\r\n         $price = number_format($prod[\"Price\"], 2);\r\n \r\n         $html .= '\r\n-        <div class=\"cart-item mb-3\">\r\n-            <div class=\"row align-items-center\">\r\n-                <div class=\"col-md-2 col-3\">\r\n-                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-                </div>\r\n+      <div class=\"cart-item mb-3\">\r\n+    <div class=\"row align-items-center\">\r\n+        <!-- Checkbox Column -->\r\n+        <div class=\"col-1 d-flex justify-content-center\">\r\n+            <input type=\"checkbox\" class=\"cart-checkbox\" data-product=\"<?= htmlspecialchars($productName) ?>\">\r\n+        </div>\r\n \r\n-                <div class=\"col-md-6 col-9\">\r\n-                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-                </div>\r\n+        <!-- Product Image -->\r\n+        <div class=\"col-md-2 col-3\">\r\n+            <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+        </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                    <div class=\"input-group input-group-sm\">\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n-                    </div>\r\n-                </div>\r\n+        <!-- Product Name & Description -->\r\n+        <div class=\"col-md-6 col-9\">\r\n+            <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+            <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+        </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n-                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n-                </div>\r\n+        <!-- Quantity Controls -->\r\n+        <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+            <div class=\"input-group input-group-sm\">\r\n+                <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n+                <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n             </div>\r\n-        </div>';\r\n+        </div>\r\n+\r\n+        <!-- Price & Remove -->\r\n+        <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+            <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n+            <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+        </div>\r\n+    </div>\r\n+</div>\r\n+\r\n     }\r\n }\r\n \r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n"
                },
                {
                    "date": 1767769338034,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,47 +61,38 @@\n \r\n     if ($prodResult->num_rows > 0) {\r\n         $prod = $prodResult->fetch_assoc();\r\n        $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+\r\n         $desc = $prod[\"Description\"];\r\n         $price = number_format($prod[\"Price\"], 2);\r\n \r\n         $html .= '\r\n-      <div class=\"cart-item mb-3\">\r\n-    <div class=\"row align-items-center\">\r\n-        <!-- Checkbox Column -->\r\n-        <div class=\"col-1 d-flex justify-content-center\">\r\n-            <input type=\"checkbox\" class=\"cart-checkbox\" data-product=\"<?= htmlspecialchars($productName) ?>\">\r\n-        </div>\r\n+        <div class=\"cart-item mb-3\">\r\n+            <div class=\"row align-items-center\">\r\n+                <div class=\"col-md-2 col-3\">\r\n+                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+                </div>\r\n \r\n-        <!-- Product Image -->\r\n-        <div class=\"col-md-2 col-3\">\r\n-            <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-        </div>\r\n+                <div class=\"col-md-6 col-9\">\r\n+                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+                </div>\r\n \r\n-        <!-- Product Name & Description -->\r\n-        <div class=\"col-md-6 col-9\">\r\n-            <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-            <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-        </div>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                    <div class=\"input-group input-group-sm\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                    </div>\r\n+                </div>\r\n \r\n-        <!-- Quantity Controls -->\r\n-        <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-            <div class=\"input-group input-group-sm\">\r\n-                <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n-                <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n+                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+                </div>\r\n             </div>\r\n-        </div>\r\n-\r\n-        <!-- Price & Remove -->\r\n-        <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-            <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n-            <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n-        </div>\r\n-    </div>\r\n-</div>\r\n-\r\n+        </div>';\r\n     }\r\n }\r\n \r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n"
                },
                {
                    "date": 1767775938031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,43 +58,53 @@\n     $prodSQL->bind_param(\"s\", $productName);\r\n     $prodSQL->execute();\r\n     $prodResult = $prodSQL->get_result();\r\n \r\n-    if ($prodResult->num_rows > 0) {\r\n-        $prod = $prodResult->fetch_assoc();\r\n-       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+  if ($prodResult->num_rows > 0) {\r\n+    $prod = $prodResult->fetch_assoc();\r\n+    $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+    $desc = $prod[\"Description\"];\r\n+    $price = number_format($prod[\"Price\"], 2);\r\n \r\n-        $desc = $prod[\"Description\"];\r\n-        $price = number_format($prod[\"Price\"], 2);\r\n+    $html .= '\r\n+    <div class=\"cart-item mb-3\">\r\n+        <div class=\"row align-items-center\">\r\n \r\n-        $html .= '\r\n-        <div class=\"cart-item mb-3\">\r\n-            <div class=\"row align-items-center\">\r\n-                <div class=\"col-md-2 col-3\">\r\n-                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-                </div>\r\n+            <!-- Checkbox -->\r\n+            <div class=\"col-auto d-flex justify-content-center align-items-center\">\r\n+                <input type=\"checkbox\" class=\"cart-checkbox\">\r\n+            </div>\r\n \r\n-                <div class=\"col-md-6 col-9\">\r\n-                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-                </div>\r\n+            <!-- Product Image -->\r\n+            <div class=\"col-md-2 col-3\">\r\n+                <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+            </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                    <div class=\"input-group input-group-sm\">\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n-                    </div>\r\n-                </div>\r\n+            <!-- Product Info -->\r\n+            <div class=\"col-md-5 col-6\">\r\n+                <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+            </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n-                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+            <!-- Quantity controls -->\r\n+            <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                <div class=\"input-group input-group-sm\">\r\n+                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                    <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly id=\"quantity\">\r\n+                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n                 </div>\r\n             </div>\r\n-        </div>';\r\n-    }\r\n+\r\n+            <!-- Price & Remove -->\r\n+            <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                <h5 class=\"text-primary mb-0\" id=\"price\">₱'.$price.'</h5>\r\n+                <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+            </div>\r\n+\r\n+        </div>\r\n+    </div>';\r\n }\r\n \r\n+\r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767775963124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,53 +58,42 @@\n     $prodSQL->bind_param(\"s\", $productName);\r\n     $prodSQL->execute();\r\n     $prodResult = $prodSQL->get_result();\r\n \r\n-  if ($prodResult->num_rows > 0) {\r\n-    $prod = $prodResult->fetch_assoc();\r\n-    $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n-    $desc = $prod[\"Description\"];\r\n-    $price = number_format($prod[\"Price\"], 2);\r\n+    if ($prodResult->num_rows > 0) {\r\n+        $prod = $prodResult->fetch_assoc();\r\n+       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+        $desc = $prod[\"Description\"];\r\n+        $price = number_format($prod[\"Price\"], 2);\r\n \r\n-    $html .= '\r\n-    <div class=\"cart-item mb-3\">\r\n-        <div class=\"row align-items-center\">\r\n+        $html .= '\r\n+        <div class=\"cart-item mb-3\">\r\n+            <div class=\"row align-items-center\">\r\n+                <div class=\"col-md-2 col-3\">\r\n+                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+                </div>\r\n \r\n-            <!-- Checkbox -->\r\n-            <div class=\"col-auto d-flex justify-content-center align-items-center\">\r\n-                <input type=\"checkbox\" class=\"cart-checkbox\">\r\n-            </div>\r\n+                <div class=\"col-md-6 col-9\">\r\n+                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+                </div>\r\n \r\n-            <!-- Product Image -->\r\n-            <div class=\"col-md-2 col-3\">\r\n-                <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-            </div>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                    <div class=\"input-group input-group-sm\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                    </div>\r\n+                </div>\r\n \r\n-            <!-- Product Info -->\r\n-            <div class=\"col-md-5 col-6\">\r\n-                <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-            </div>\r\n-\r\n-            <!-- Quantity controls -->\r\n-            <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                <div class=\"input-group input-group-sm\">\r\n-                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                    <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly id=\"quantity\">\r\n-                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n+                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n                 </div>\r\n             </div>\r\n-\r\n-            <!-- Price & Remove -->\r\n-            <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                <h5 class=\"text-primary mb-0\" id=\"price\">₱'.$price.'</h5>\r\n-                <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n-            </div>\r\n-\r\n-        </div>\r\n-    </div>';\r\n+        </div>';\r\n+    }\r\n }\r\n \r\n-\r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767775972277,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,42 +58,53 @@\n     $prodSQL->bind_param(\"s\", $productName);\r\n     $prodSQL->execute();\r\n     $prodResult = $prodSQL->get_result();\r\n \r\n-    if ($prodResult->num_rows > 0) {\r\n-        $prod = $prodResult->fetch_assoc();\r\n-       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n-        $desc = $prod[\"Description\"];\r\n-        $price = number_format($prod[\"Price\"], 2);\r\n+  if ($prodResult->num_rows > 0) {\r\n+    $prod = $prodResult->fetch_assoc();\r\n+    $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+    $desc = $prod[\"Description\"];\r\n+    $price = number_format($prod[\"Price\"], 2);\r\n \r\n-        $html .= '\r\n-        <div class=\"cart-item mb-3\">\r\n-            <div class=\"row align-items-center\">\r\n-                <div class=\"col-md-2 col-3\">\r\n-                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-                </div>\r\n+    $html .= '\r\n+    <div class=\"cart-item mb-3\">\r\n+        <div class=\"row align-items-center\">\r\n \r\n-                <div class=\"col-md-6 col-9\">\r\n-                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-                </div>\r\n+            <!-- Checkbox -->\r\n+            <div class=\"col-auto d-flex justify-content-center align-items-center\">\r\n+                <input type=\"checkbox\" class=\"cart-checkbox\">\r\n+            </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                    <div class=\"input-group input-group-sm\">\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n-                    </div>\r\n-                </div>\r\n+            <!-- Product Image -->\r\n+            <div class=\"col-md-2 col-3\">\r\n+                <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+            </div>\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n-                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+            <!-- Product Info -->\r\n+            <div class=\"col-md-5 col-6\">\r\n+                <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+            </div>\r\n+\r\n+            <!-- Quantity controls -->\r\n+            <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                <div class=\"input-group input-group-sm\">\r\n+                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                    <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly id=\"quantity\">\r\n+                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n                 </div>\r\n             </div>\r\n-        </div>';\r\n-    }\r\n+\r\n+            <!-- Price & Remove -->\r\n+            <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                <h5 class=\"text-primary mb-0\" id=\"price\">₱'.$price.'</h5>\r\n+                <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+            </div>\r\n+\r\n+        </div>\r\n+    </div>';\r\n }\r\n \r\n+\r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767775979484,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,53 +58,42 @@\n     $prodSQL->bind_param(\"s\", $productName);\r\n     $prodSQL->execute();\r\n     $prodResult = $prodSQL->get_result();\r\n \r\n-  if ($prodResult->num_rows > 0) {\r\n-    $prod = $prodResult->fetch_assoc();\r\n-    $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n-    $desc = $prod[\"Description\"];\r\n-    $price = number_format($prod[\"Price\"], 2);\r\n+    if ($prodResult->num_rows > 0) {\r\n+        $prod = $prodResult->fetch_assoc();\r\n+       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+        $desc = $prod[\"Description\"];\r\n+        $price = number_format($prod[\"Price\"], 2);\r\n \r\n-    $html .= '\r\n-    <div class=\"cart-item mb-3\">\r\n-        <div class=\"row align-items-center\">\r\n+        $html .= '\r\n+        <div class=\"cart-item mb-3\">\r\n+            <div class=\"row align-items-center\">\r\n+                <div class=\"col-md-2 col-3\">\r\n+                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+                </div>\r\n \r\n-            <!-- Checkbox -->\r\n-            <div class=\"col-auto d-flex justify-content-center align-items-center\">\r\n-                <input type=\"checkbox\" class=\"cart-checkbox\">\r\n-            </div>\r\n+                <div class=\"col-md-6 col-9\">\r\n+                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+                </div>\r\n \r\n-            <!-- Product Image -->\r\n-            <div class=\"col-md-2 col-3\">\r\n-                <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-            </div>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                    <div class=\"input-group input-group-sm\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                    </div>\r\n+                </div>\r\n \r\n-            <!-- Product Info -->\r\n-            <div class=\"col-md-5 col-6\">\r\n-                <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-            </div>\r\n-\r\n-            <!-- Quantity controls -->\r\n-            <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                <div class=\"input-group input-group-sm\">\r\n-                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                    <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly id=\"quantity\">\r\n-                    <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n+                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n                 </div>\r\n             </div>\r\n-\r\n-            <!-- Price & Remove -->\r\n-            <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                <h5 class=\"text-primary mb-0\" id=\"price\">₱'.$price.'</h5>\r\n-                <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n-            </div>\r\n-\r\n-        </div>\r\n-    </div>';\r\n+        </div>';\r\n+    }\r\n }\r\n \r\n-\r\n echo json_encode([\"success\" => true, \"html\" => $html]);\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1767776088765,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,99 +1,193 @@\n-<?php\r\n-header(\"Content-Type: application/json\");\r\n-error_reporting(E_ALL);\r\n-ini_set(\"display_errors\", 1);\r\n+    document.addEventListener(\"DOMContentLoaded\", () => {\r\n+            try {\r\n+                const cardsContainer = document.getElementById(\"cards\");\r\n+                const totalEl = document.getElementById(\"total\");\r\n \r\n-$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n-if ($conn->connect_error) {\r\n-    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"DB connection failed\"]);\r\n-    exit;\r\n-}\r\n+                console.log(\"DOM fully loaded\");\r\n \r\n-$user_id = $_POST[\"user_id\"] ?? '';\r\n-$cart    = $_POST[\"cart\"] ?? null;\r\n-$change  = isset($_POST[\"change\"]) ? intval($_POST[\"change\"]) : null;\r\n+                if (!cardsContainer) {\r\n+                    console.error(\"❌ Error: #cards container not found in DOM\");\r\n+                    return;\r\n+                } else {\r\n+                    console.log(\"✅ #cards container found\");\r\n+                }\r\n \r\n+                if (!totalEl) {\r\n+                    console.warn(\"⚠️ #total element not found in DOM. Total won't display\");\r\n+                } else {\r\n+                    console.log(\"✅ #total element found\");\r\n+                }\r\n \r\n+                // Get all cart items\r\n+                const cartItems = cardsContainer.querySelectorAll(\".cart-item\");\r\n+                console.log(`Found ${cartItems.length} cart item(s)`);\r\n \r\n-$remove = isset($_POST[\"remove\"]) ? intval($_POST[\"remove\"]) : null;\r\n+                if (cartItems.length === 0) {\r\n+                    console.warn(\"⚠️ No cart items found inside #cards\");\r\n+                }\r\n \r\n-if ($cart !== null && $remove === 1) {\r\n-    $del = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n-    $del->bind_param(\"is\", $user_id, $cart);\r\n-    $del->execute();\r\n-    $del->close();\r\n-}\r\n+                cartItems.forEach((item, index) => {\r\n+                    console.log(`Processing cart item at index ${index}`);\r\n \r\n+                    const row = item.querySelector(\".row\");\r\n+                    if (!row) {\r\n+                        console.error(`❌ Cart item at index ${index} has no .row element`);\r\n+                        return;\r\n+                    } else {\r\n+                        console.log(`✅ Found .row for cart item at index ${index}`);\r\n+                    }\r\n \r\n-// ---------------------------\r\n-// STEP 1: If change exists, update quantity\r\n-// ---------------------------\r\n-if ($cart !== null && $change !== null) {\r\n-    $update = $conn->prepare(\"UPDATE carts SET Quantity = GREATEST(1, Quantity + ?) WHERE user_id = ? AND Cart = ?\");\r\n-    $update->bind_param(\"iis\", $change, $user_id, $cart);\r\n-    $update->execute();\r\n-    $update->close();\r\n-}\r\n+                    if (!item.querySelector(\".cart-checkbox\")) {\r\n+                        const checkboxCol = document.createElement(\"div\");\r\n+                        checkboxCol.className = \"col-1 d-flex justify-content-center align-items-center\";\r\n \r\n-// ---------------------------\r\n-// STEP 2: Fetch cart items & build HTML\r\n-// ---------------------------\r\n-$cartSQL = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n-$cartSQL->bind_param(\"i\", $user_id);\r\n-$cartSQL->execute();\r\n-$cartResult = $cartSQL->get_result();\r\n+                        const checkbox = document.createElement(\"input\");\r\n+                        checkbox.type = \"checkbox\";\r\n+                        checkbox.className = \"cart-checkbox\";\r\n \r\n-if ($cartResult->num_rows == 0) {\r\n-    echo json_encode([\"success\" => true, \"html\" => \"<p>No items in your cart.</p>\"]);\r\n-    exit;\r\n-}\r\n+                        checkboxCol.appendChild(checkbox);\r\n+                        row.insertBefore(checkboxCol, row.firstChild);\r\n+                        console.log(`✅ Checkbox added to cart item at index ${index}`);\r\n \r\n-$html = \"\";\r\n+                        // Add event listener to recalc total\r\n+                        checkbox.addEventListener(\"change\", () => {\r\n+                            console.log(`🔔 Checkbox changed at index ${index}`);\r\n+                            try {\r\n+                                calculateTotal();\r\n+                            } catch (err) {\r\n+                                console.error(\"❌ Error calculating total on checkbox change:\", err);\r\n+                            }\r\n+                        });\r\n+                    } else {\r\n+                        console.log(`ℹ️ Cart item at index ${index} already has a checkbox`);\r\n+                    }\r\n+                });\r\n \r\n-while ($cartRow = $cartResult->fetch_assoc()) {\r\n-    $productName = $cartRow[\"Cart\"];\r\n-    $quantity = $cartRow[\"Quantity\"];\r\n+                // Calculate total on page load\r\n+                try {\r\n+                    console.log(\"Calculating initial total...\");\r\n+                    calculateTotal();\r\n+                } catch (err) {\r\n+                    console.error(\"❌ Error calculating total on page load:\", err);\r\n+                }\r\n \r\n-    $prodSQL = $conn->prepare(\"SELECT `Product Name`, `Description`, `Product Img`, `Price` FROM products WHERE `Product Name` = ? LIMIT 1\");\r\n-    $prodSQL->bind_param(\"s\", $productName);\r\n-    $prodSQL->execute();\r\n-    $prodResult = $prodSQL->get_result();\r\n+                function calculateTotal() {\r\n+                    if (!cardsContainer) {\r\n+                        console.error(\"❌ Cannot calculate total: #cards container missing\");\r\n+                        return;\r\n+                    }\r\n \r\n-    if ($prodResult->num_rows > 0) {\r\n-        $prod = $prodResult->fetch_assoc();\r\n-       $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n-        $desc = $prod[\"Description\"];\r\n-        $price = number_format($prod[\"Price\"], 2);\r\n+                    let total = 0;\r\n+                    const items = cardsContainer.querySelectorAll(\".cart-item\");\r\n+                    console.log(`Calculating total for ${items.length} cart item(s)`);\r\n \r\n-        $html .= '\r\n-        <div class=\"cart-item mb-3\">\r\n-            <div class=\"row align-items-center\">\r\n-                <div class=\"col-md-2 col-3\">\r\n-                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n-                </div>\r\n+                    items.forEach((item, index) => {\r\n+                        const checkbox = item.querySelector(\".cart-checkbox\");\r\n+                        const priceEl = item.querySelector(\"#price\");\r\n+                        const qtyInput = item.querySelector(\"#quantity\");\r\n \r\n-                <div class=\"col-md-6 col-9\">\r\n-                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n-                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n-                </div>\r\n+                        if (!priceEl) {\r\n+                            console.warn(`⚠️ Cart item at index ${index} has no #price element`);\r\n+                            return;\r\n+                        }\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n-                    <div class=\"input-group input-group-sm\">\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n-                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly>\r\n-                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n-                    </div>\r\n-                </div>\r\n+                        if (!qtyInput) {\r\n+                            console.warn(`⚠️ Cart item at index ${index} has no #quantity input`);\r\n+                            return;\r\n+                        }\r\n \r\n-                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n-                    <h5 class=\"text-primary mb-0\">₱'.$price.'</h5>\r\n-                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n-                </div>\r\n-            </div>\r\n-        </div>';\r\n-    }\r\n-}\r\n+                        const price = parseFloat(priceEl.textContent.replace(/[₱,$]/g, \"\")) || 0;\r\n+                        const quantity = parseInt(qtyInput.value) || 1;\r\n \r\n-echo json_encode([\"success\" => true, \"html\" => $html]);\r\n-$conn->close();\r\n-?>\r\n+                        if (checkbox && checkbox.checked) {\r\n+                            total += price * quantity;\r\n+                            console.log(`Item ${index} checked: ${quantity} × ${price} = ${quantity * price}`);\r\n+                        } else {\r\n+                            console.log(`Item ${index} not checked or no checkbox`);\r\n+                        }\r\n+                    });\r\n+\r\n+                    if (totalEl) {\r\n+                        totalEl.textContent = `₱${total.toFixed(2)}`;\r\n+                        console.log(`✅ Total updated: ₱${total.toFixed(2)}`);\r\n+                    } else {\r\n+                        console.warn(\"⚠️ Total element missing, cannot display total\");\r\n+                    }\r\n+                }\r\n+\r\n+            } catch (err) {\r\n+                console.error(\"❌ Unexpected error in DOMContentLoaded:\", err);\r\n+            }\r\n+        });\r\n+\r\n+        function increaseQty(btn) {\r\n+            const input = btn.previousElementSibling;\r\n+            let currentValue = parseInt(input.value);\r\n+            input.value = currentValue + 1;\r\n+            updateTotal();\r\n+        }\r\n+\r\n+        function decreaseQty(btn) {\r\n+            const input = btn.nextElementSibling;\r\n+            let currentValue = parseInt(input.value);\r\n+            if (currentValue > 1) {\r\n+                input.value = currentValue - 1;\r\n+                updateTotal();\r\n+            }\r\n+        }\r\n+\r\n+        document.addEventListener(\"DOMContentLoaded\", loadCart);\r\n+\r\n+        function loadCart() {\r\n+            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n+            if (!currentUser) return;\r\n+\r\n+            const data = new FormData();\r\n+            data.append(\"user_id\", currentUser.id);\r\n+\r\n+            fetch(\"php/checkout.php\", {\r\n+                method: \"POST\",\r\n+                body: data\r\n+            })\r\n+                .then(res => res.json())\r\n+                .then(result => {\r\n+                    document.getElementById(\"cards\").innerHTML = result.html;\r\n+                });\r\n+        }\r\n+\r\n+        // Called when clicking + or - button\r\n+        function updateQty(productName, change) {\r\n+            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n+            if (!currentUser) return;\r\n+\r\n+            const data = new FormData();\r\n+            data.append(\"user_id\", currentUser.id);\r\n+            data.append(\"cart\", productName);\r\n+            data.append(\"change\", change);\r\n+\r\n+            fetch(\"php/checkout.php\", {\r\n+                method: \"POST\",\r\n+                body: data\r\n+            })\r\n+                .then(res => res.json())\r\n+                .then(() => loadCart()); // reload cart after update\r\n+        }\r\n+\r\n+        // Remove item\r\n+        function removeItem(productName) {\r\n+            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n+            if (!currentUser) return;\r\n+\r\n+            const data = new FormData();\r\n+            data.append(\"user_id\", currentUser.id);\r\n+            data.append(\"cart\", productName);\r\n+            data.append(\"remove\", 1);\r\n+\r\n+            fetch(\"php/checkout.php\", {\r\n+                method: \"POST\",\r\n+                body: data\r\n+            })\r\n+                .then(res => res.json())\r\n+                .then(() => loadCart());\r\n+        }\r\n+\r\n"
                },
                {
                    "date": 1767776099791,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,193 +1,103 @@\n-    document.addEventListener(\"DOMContentLoaded\", () => {\r\n-            try {\r\n-                const cardsContainer = document.getElementById(\"cards\");\r\n-                const totalEl = document.getElementById(\"total\");\r\n+<?php\r\n+header(\"Content-Type: application/json\");\r\n+error_reporting(E_ALL);\r\n+ini_set(\"display_errors\", 1);\r\n \r\n-                console.log(\"DOM fully loaded\");\r\n+$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\n+if ($conn->connect_error) {\r\n+    echo json_encode([\"success\" => false, \"html\" => \"\", \"message\" => \"DB connection failed\"]);\r\n+    exit;\r\n+}\r\n \r\n-                if (!cardsContainer) {\r\n-                    console.error(\"❌ Error: #cards container not found in DOM\");\r\n-                    return;\r\n-                } else {\r\n-                    console.log(\"✅ #cards container found\");\r\n-                }\r\n+$user_id = $_POST[\"user_id\"] ?? '';\r\n+$cart    = $_POST[\"cart\"] ?? null;\r\n+$change  = isset($_POST[\"change\"]) ? intval($_POST[\"change\"]) : null;\r\n+$remove  = isset($_POST[\"remove\"]) ? intval($_POST[\"remove\"]) : null;\r\n \r\n-                if (!totalEl) {\r\n-                    console.warn(\"⚠️ #total element not found in DOM. Total won't display\");\r\n-                } else {\r\n-                    console.log(\"✅ #total element found\");\r\n-                }\r\n+// Remove item\r\n+if ($cart !== null && $remove === 1) {\r\n+    $del = $conn->prepare(\"DELETE FROM carts WHERE user_id = ? AND Cart = ?\");\r\n+    $del->bind_param(\"is\", $user_id, $cart);\r\n+    $del->execute();\r\n+    $del->close();\r\n+}\r\n \r\n-                // Get all cart items\r\n-                const cartItems = cardsContainer.querySelectorAll(\".cart-item\");\r\n-                console.log(`Found ${cartItems.length} cart item(s)`);\r\n+// Update quantity\r\n+if ($cart !== null && $change !== null) {\r\n+    $update = $conn->prepare(\"UPDATE carts SET Quantity = GREATEST(1, Quantity + ?) WHERE user_id = ? AND Cart = ?\");\r\n+    $update->bind_param(\"iis\", $change, $user_id, $cart);\r\n+    $update->execute();\r\n+    $update->close();\r\n+}\r\n \r\n-                if (cartItems.length === 0) {\r\n-                    console.warn(\"⚠️ No cart items found inside #cards\");\r\n-                }\r\n+// Fetch cart items\r\n+$cartSQL = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n+$cartSQL->bind_param(\"i\", $user_id);\r\n+$cartSQL->execute();\r\n+$cartResult = $cartSQL->get_result();\r\n \r\n-                cartItems.forEach((item, index) => {\r\n-                    console.log(`Processing cart item at index ${index}`);\r\n+if ($cartResult->num_rows == 0) {\r\n+    echo json_encode([\"success\" => true, \"html\" => \"<p>No items in your cart.</p>\"]);\r\n+    exit;\r\n+}\r\n \r\n-                    const row = item.querySelector(\".row\");\r\n-                    if (!row) {\r\n-                        console.error(`❌ Cart item at index ${index} has no .row element`);\r\n-                        return;\r\n-                    } else {\r\n-                        console.log(`✅ Found .row for cart item at index ${index}`);\r\n-                    }\r\n+$html = \"\";\r\n \r\n-                    if (!item.querySelector(\".cart-checkbox\")) {\r\n-                        const checkboxCol = document.createElement(\"div\");\r\n-                        checkboxCol.className = \"col-1 d-flex justify-content-center align-items-center\";\r\n+while ($cartRow = $cartResult->fetch_assoc()) {\r\n+    $productName = $cartRow[\"Cart\"];\r\n+    $quantity = $cartRow[\"Quantity\"];\r\n \r\n-                        const checkbox = document.createElement(\"input\");\r\n-                        checkbox.type = \"checkbox\";\r\n-                        checkbox.className = \"cart-checkbox\";\r\n+    $prodSQL = $conn->prepare(\"SELECT `Product Name`, `Description`, `Product Img`, `Price` FROM products WHERE `Product Name` = ? LIMIT 1\");\r\n+    $prodSQL->bind_param(\"s\", $productName);\r\n+    $prodSQL->execute();\r\n+    $prodResult = $prodSQL->get_result();\r\n \r\n-                        checkboxCol.appendChild(checkbox);\r\n-                        row.insertBefore(checkboxCol, row.firstChild);\r\n-                        console.log(`✅ Checkbox added to cart item at index ${index}`);\r\n+    if ($prodResult->num_rows > 0) {\r\n+        $prod = $prodResult->fetch_assoc();\r\n+        $img = !empty($prod[\"Product Img\"]) ? 'php/' . $prod[\"Product Img\"] : '';\r\n+        $desc = $prod[\"Description\"];\r\n+        $price = number_format($prod[\"Price\"], 2);\r\n \r\n-                        // Add event listener to recalc total\r\n-                        checkbox.addEventListener(\"change\", () => {\r\n-                            console.log(`🔔 Checkbox changed at index ${index}`);\r\n-                            try {\r\n-                                calculateTotal();\r\n-                            } catch (err) {\r\n-                                console.error(\"❌ Error calculating total on checkbox change:\", err);\r\n-                            }\r\n-                        });\r\n-                    } else {\r\n-                        console.log(`ℹ️ Cart item at index ${index} already has a checkbox`);\r\n-                    }\r\n-                });\r\n+        $html .= '\r\n+        <div class=\"cart-item mb-3\">\r\n+            <div class=\"row align-items-center\">\r\n \r\n-                // Calculate total on page load\r\n-                try {\r\n-                    console.log(\"Calculating initial total...\");\r\n-                    calculateTotal();\r\n-                } catch (err) {\r\n-                    console.error(\"❌ Error calculating total on page load:\", err);\r\n-                }\r\n+                <!-- Checkbox -->\r\n+                <div class=\"col-auto d-flex justify-content-center align-items-center\">\r\n+                    <input type=\"checkbox\" class=\"cart-checkbox\">\r\n+                </div>\r\n \r\n-                function calculateTotal() {\r\n-                    if (!cardsContainer) {\r\n-                        console.error(\"❌ Cannot calculate total: #cards container missing\");\r\n-                        return;\r\n-                    }\r\n+                <!-- Product Image -->\r\n+                <div class=\"col-md-2 col-3\">\r\n+                    <img src=\"'.$img.'\" class=\"img-fluid\" alt=\"Product\">\r\n+                </div>\r\n \r\n-                    let total = 0;\r\n-                    const items = cardsContainer.querySelectorAll(\".cart-item\");\r\n-                    console.log(`Calculating total for ${items.length} cart item(s)`);\r\n+                <!-- Product Info -->\r\n+                <div class=\"col-md-5 col-6\">\r\n+                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n+                </div>\r\n \r\n-                    items.forEach((item, index) => {\r\n-                        const checkbox = item.querySelector(\".cart-checkbox\");\r\n-                        const priceEl = item.querySelector(\"#price\");\r\n-                        const qtyInput = item.querySelector(\"#quantity\");\r\n+                <!-- Quantity controls -->\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0\">\r\n+                    <div class=\"input-group input-group-sm\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', -1)\">-</button>\r\n+                        <input type=\"number\" class=\"form-control text-center\" value=\"'.$quantity.'\" readonly id=\"quantity\">\r\n+                        <button class=\"btn btn-outline-secondary\" type=\"button\" onclick=\"updateQty(\\''.$productName.'\\', 1)\">+</button>\r\n+                    </div>\r\n+                </div>\r\n \r\n-                        if (!priceEl) {\r\n-                            console.warn(`⚠️ Cart item at index ${index} has no #price element`);\r\n-                            return;\r\n-                        }\r\n+                <!-- Price & Remove -->\r\n+                <div class=\"col-md-2 col-6 mt-2 mt-md-0 text-end\">\r\n+                    <h5 class=\"text-primary mb-0\" id=\"price\">₱'.$price.'</h5>\r\n+                    <button class=\"btn btn-sm btn-outline-danger mt-1\" onclick=\"removeItem(\\''.$productName.'\\')\">Remove</button>\r\n+                </div>\r\n \r\n-                        if (!qtyInput) {\r\n-                            console.warn(`⚠️ Cart item at index ${index} has no #quantity input`);\r\n-                            return;\r\n-                        }\r\n+            </div>\r\n+        </div>';\r\n+    }\r\n+}\r\n \r\n-                        const price = parseFloat(priceEl.textContent.replace(/[₱,$]/g, \"\")) || 0;\r\n-                        const quantity = parseInt(qtyInput.value) || 1;\r\n-\r\n-                        if (checkbox && checkbox.checked) {\r\n-                            total += price * quantity;\r\n-                            console.log(`Item ${index} checked: ${quantity} × ${price} = ${quantity * price}`);\r\n-                        } else {\r\n-                            console.log(`Item ${index} not checked or no checkbox`);\r\n-                        }\r\n-                    });\r\n-\r\n-                    if (totalEl) {\r\n-                        totalEl.textContent = `₱${total.toFixed(2)}`;\r\n-                        console.log(`✅ Total updated: ₱${total.toFixed(2)}`);\r\n-                    } else {\r\n-                        console.warn(\"⚠️ Total element missing, cannot display total\");\r\n-                    }\r\n-                }\r\n-\r\n-            } catch (err) {\r\n-                console.error(\"❌ Unexpected error in DOMContentLoaded:\", err);\r\n-            }\r\n-        });\r\n-\r\n-        function increaseQty(btn) {\r\n-            const input = btn.previousElementSibling;\r\n-            let currentValue = parseInt(input.value);\r\n-            input.value = currentValue + 1;\r\n-            updateTotal();\r\n-        }\r\n-\r\n-        function decreaseQty(btn) {\r\n-            const input = btn.nextElementSibling;\r\n-            let currentValue = parseInt(input.value);\r\n-            if (currentValue > 1) {\r\n-                input.value = currentValue - 1;\r\n-                updateTotal();\r\n-            }\r\n-        }\r\n-\r\n-        document.addEventListener(\"DOMContentLoaded\", loadCart);\r\n-\r\n-        function loadCart() {\r\n-            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n-            if (!currentUser) return;\r\n-\r\n-            const data = new FormData();\r\n-            data.append(\"user_id\", currentUser.id);\r\n-\r\n-            fetch(\"php/checkout.php\", {\r\n-                method: \"POST\",\r\n-                body: data\r\n-            })\r\n-                .then(res => res.json())\r\n-                .then(result => {\r\n-                    document.getElementById(\"cards\").innerHTML = result.html;\r\n-                });\r\n-        }\r\n-\r\n-        // Called when clicking + or - button\r\n-        function updateQty(productName, change) {\r\n-            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n-            if (!currentUser) return;\r\n-\r\n-            const data = new FormData();\r\n-            data.append(\"user_id\", currentUser.id);\r\n-            data.append(\"cart\", productName);\r\n-            data.append(\"change\", change);\r\n-\r\n-            fetch(\"php/checkout.php\", {\r\n-                method: \"POST\",\r\n-                body: data\r\n-            })\r\n-                .then(res => res.json())\r\n-                .then(() => loadCart()); // reload cart after update\r\n-        }\r\n-\r\n-        // Remove item\r\n-        function removeItem(productName) {\r\n-            const currentUser = JSON.parse(localStorage.getItem(\"currentUser\"));\r\n-            if (!currentUser) return;\r\n-\r\n-            const data = new FormData();\r\n-            data.append(\"user_id\", currentUser.id);\r\n-            data.append(\"cart\", productName);\r\n-            data.append(\"remove\", 1);\r\n-\r\n-            fetch(\"php/checkout.php\", {\r\n-                method: \"POST\",\r\n-                body: data\r\n-            })\r\n-                .then(res => res.json())\r\n-                .then(() => loadCart());\r\n-        }\r\n-\r\n+echo json_encode([\"success\" => true, \"html\" => $html]);\r\n+$conn->close();\r\n+?>\r\n"
                },
                {
                    "date": 1767850006704,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n                 </div>\r\n \r\n                 <!-- Product Info -->\r\n                 <div class=\"col-md-5 col-6\">\r\n-                    <h5 class=\"mb-1\">'.$productName.'</h5>\r\n+                    <h5 class=\"mb-1\" id>'.$productName.'</h5>\r\n                     <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n                 </div>\r\n \r\n                 <!-- Quantity controls -->\r\n"
                },
                {
                    "date": 1767850014992,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n                 </div>\r\n \r\n                 <!-- Product Info -->\r\n                 <div class=\"col-md-5 col-6\">\r\n-                    <h5 class=\"mb-1\" id>'.$productName.'</h5>\r\n+                    <h5 class=\"mb-1\" id=\">'.$productName.'</h5>\r\n                     <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n                 </div>\r\n \r\n                 <!-- Quantity controls -->\r\n"
                },
                {
                    "date": 1767850020235,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n                 </div>\r\n \r\n                 <!-- Product Info -->\r\n                 <div class=\"col-md-5 col-6\">\r\n-                    <h5 class=\"mb-1\" id=\">'.$productName.'</h5>\r\n+                    <h5 class=\"mb-1\" id=\"prodName\">'.$productName.'</h5>\r\n                     <p class=\"text-muted small mb-0\">'.$desc.'</p>\r\n                 </div>\r\n \r\n                 <!-- Quantity controls -->\r\n"
                }
            ],
            "date": 1767767770942,
            "name": "Commit-0",
            "content": "<?php\r\nheader(\"Content-Type: application/json\");\r\nerror_reporting(E_ALL);\r\nini_set(\"display_errors\", 1);\r\n\r\n$conn = new mysqli(\"localhost\", \"root\", \"\", \"ecommerce\");\r\nif ($conn->connect_error) {\r\n    echo json_encode([\"success\" => false, \"message\" => \"DB connection failed\"]);\r\n    exit;\r\n}\r\n\r\n$user_id = $_GET[\"user_id\"] ?? \"\";\r\n\r\nif (!$user_id) {\r\n    echo json_encode([\"success\" => false, \"message\" => \"Missing user_id\"]);\r\n    exit;\r\n}\r\n\r\n// GET USER CART\r\n$cartQuery = $conn->prepare(\"SELECT Cart, Quantity FROM carts WHERE user_id = ?\");\r\n$cartQuery->bind_param(\"i\", $user_id);\r\n$cartQuery->execute();\r\n$cartResult = $cartQuery->get_result();\r\n\r\n$cartItems = [];\r\n\r\nwhile ($row = $cartResult->fetch_assoc()) {\r\n\r\n    // Get product info from products table\r\n    $productName = $row[\"Cart\"];\r\n\r\n    $productQuery = $conn->prepare(\r\n        \"SELECT `Product Name`, `Description`, `Product Img`, `Price`\r\n         FROM products WHERE `Product Name` = ? LIMIT 1\"\r\n    );\r\n    $productQuery->bind_param(\"s\", $productName);\r\n    $productQuery->execute();\r\n    $productData = $productQuery->get_result()->fetch_assoc();\r\n\r\n    if ($productData) {\r\n        $cartItems[] = [\r\n            \"name\"        => $productName,\r\n            \"quantity\"    => $row[\"Quantity\"],\r\n            \"description\" => $productData[\"Description\"],\r\n            \"img\"         => $productData[\"Product Img\"],\r\n            \"price\"       => $productData[\"Price\"]\r\n        ];\r\n    }\r\n}\r\n\r\necho json_encode([\r\n    \"success\" => true,\r\n    \"items\" => $cartItems\r\n]);\r\n\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}